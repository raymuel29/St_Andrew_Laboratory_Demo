<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St. Andrew Hospital - Login & Signup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='website-login.css') }}">
    
</head>
<body>
    
    <!-- Login Page -->
    <div id="loginPage" class="auth-page">
        <div class="auth-container">
            <div class="auth-left">
                <h1>Welcome to St. Andrew Hospital üè•</h1>
                <p>Your trusted partner in healthcare excellence</p>
                <ul class="feature-list">
                    <li>24/7 Emergency Care Services</li>
                    <li>Expert Medical Professionals</li>
                    <li>State-of-the-art Facilities</li>
                    <li>Easy Online Appointments</li>
                    <li>Comprehensive Health Records</li>
                </ul>
            </div>
            <div class="auth-right">
                <div class="auth-card">
                    <div class="auth-header">
                        <div class="logo">üè•</div>
                        <h2>Login to Your Account</h2>
                        <p>Welcome back! Please enter your details</p>
                    </div>
                    
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="loginUsername">Username</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üë§</span>
                                <input type="text" id="loginUsername" placeholder="Enter your username" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üîí</span>
                                <input type="password" id="loginPassword" placeholder="Enter your password" required>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">Login Now</button>
                    </form>

                    <div class="divider">
                        <span>OR</span>
                    </div>
                    <div class="auth-footer">
                        Don't have an account? <a onclick="showSignup()">Sign Up</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Page -->
    <div id="signupPage" class="auth-page hidden">
        <div class="auth-container">
            <div class="auth-left">
                <h1>Join St. Andrew Hospital Today! üéâ</h1>
                <p>Create your account and get access to world-class healthcare</p>
                <ul class="feature-list">
                    <li>Instant Access to Services</li>
                    <li>Book Appointments Online</li>
                    <li>Track Your Health Records</li>
                    <li>Connect with Top Doctors</li>
                    <li>Get Personalized Care Plans</li>
                </ul>
            </div>
            <div class="auth-right">
                <div class="auth-card">
                    <div class="auth-header">
                        <div class="logo">üè•</div>
                        <h2>Create Your Account</h2>
                        <p>Join thousands of satisfied patients</p>
                    </div>
                    
                    <form id="signupForm">
                        <div class="form-group">
                            <label for="signupFirstName">First Name *</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üë§</span>
                                <input type="text" id="signupFirstName" placeholder="Enter your first name" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signupMiddleName">Middle Name (Optional)</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üë§</span>
                                <input type="text" id="signupMiddleName" placeholder="Enter your middle name">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signupLastName">Last Name *</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üë§</span>
                                <input type="text" id="signupLastName" placeholder="Enter your last name" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signupUsername">Username *</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üìù</span>
                                <input type="text" id="signupUsername" placeholder="Choose a username" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signupPhone">Phone Number *</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üì±</span>
                                <input type="tel" id="signupPhone" placeholder="Enter your phone number" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password *</label>
                            <div class="input-wrapper">
                                <span class="input-icon">üîí</span>
                                <input type="password" id="signupPassword" placeholder="Create a strong password (min. 6 characters)" required>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">Create Account</button>
                    </form>

                    <div class="divider">
                        <span>OR</span>
                    </div>
                    <div class="auth-footer">
                        Already have an account? <a onclick="showLogin()">Login</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    
        // PAGE TOGGLE
        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('signupPage').classList.add('hidden');
        }

        function showSignup() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('signupPage').classList.remove('hidden');
        }

        window.addEventListener('DOMContentLoaded', showLogin);

        // LOGIN - Modified to use username
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('/api/website-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    window.location.href = data.redirect;
                } else {
                    alert(data.message || 'Login failed');
                }

            } catch (error) {
                console.error('Login error:', error);
                alert('Server error. Please try again.');
            }
        });

        // SIGNUP - Updated to handle separate name fields
        document.getElementById('signupForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            // Get individual name fields
            const firstName = document.getElementById('signupFirstName').value.trim();
            const middleName = document.getElementById('signupMiddleName').value.trim();
            const lastName = document.getElementById('signupLastName').value.trim();
            const username = document.getElementById('signupUsername').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value;

            // Validate first name and last name
            if (!firstName || !lastName) {
                alert('First name and last name are required');
                return;
            }

            // Basic validation
            if (username.length < 3) {
                alert('Username must be at least 3 characters long');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            // Validate phone number (basic check)
            if (phone.length < 10) {
                alert('Please enter a valid phone number');
                return;
            }

            try {
                const response = await fetch('/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        firstName, 
                        middleName, 
                        lastName, 
                        username, 
                        phone, 
                        password 
                    })
                });

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    alert(data.message || 'Account created successfully! You can now log in.');
                    this.reset();
                    showLogin();
                } else {
                    alert(data.message || 'Signup failed');
                }

            } catch (error) {
                console.error('Signup error:', error);
                alert('Server error. Please try again.');
            }
        });
    
    </script>
    
    
</body>
</html>